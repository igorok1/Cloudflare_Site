<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Beatbot Mini - –º–æ–±—ñ–ª—å–Ω–∏–π —Å–µ–∫–≤–µ–Ω—Å–æ—Ä</title>
<style>
  :root { --cellBase: 32px; --zoom: 1; --labelW: 80px; }
  body { margin: 0; background: #0f1220; color: #fff; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
  .app { padding: 8px; }
  header h1 { font-size: 16px; margin: 0; }
  header p { font-size: 12px; margin: 4px 0 8px; color: #cbd3ff; }
  .controls { display: flex; flex-wrap: wrap; gap: 6px; align-items: center; }
  .btn, .input, input[type=range] { font-size: 12px; }
  .btn { padding: 6px 10px; border-radius: 8px; border: 1px solid #2a2e44; background:#171a2b; color:#e7ecff; }
  .btn:active { transform: translateY(1px); }
  .seq { overflow-x: auto; border: 1px solid #2a2e44; border-radius: 10px; }
  .grid { display: grid; grid-template-columns: var(--labelW) repeat(16, calc(var(--cellBase) * var(--zoom))); }
  .rowLabel { font-size: 12px; padding: 4px; background: #12162a; position: sticky; left: 0; z-index: 2; border-right: 1px solid #2a2e44; }
  .cell { width: calc(var(--cellBase) * var(--zoom)); height: calc(var(--cellBase) * var(--zoom)); border: 1px solid #2a2e44; display: flex; align-items: center; justify-content: center; background:#0f1425; }
  .dot { width: calc(0.62 * var(--cellBase) * var(--zoom)); height: calc(0.62 * var(--cellBase) * var(--zoom)); border-radius: 50%; background: #2b2f47; transition: background .12s ease; }
  .cell.active .dot { background: #fff; }
  @media (max-width: 480px) {
    :root { --cellBase: 28px; --labelW: 60px; }
  }

  /* –®—Ç–æ—Ä–∫–∞ - –Ω–∏–∂–Ω—è –ø–∞–Ω–µ–ª—å */
  .sheet { position: fixed; left: 0; right: 0; bottom: 0; background: #171a2b; border-top: 1px solid #2a2e44; border-radius: 12px 12px 0 0; box-shadow: 0 -16px 40px rgba(0,0,0,.45); transform: translateY(100%); transition: transform .2s ease; max-height: 80vh; }
  .sheet.open { transform: translateY(0); }
  .sheet .handle { width: 44px; height: 5px; background: #3a3f61; border-radius: 999px; margin: 8px auto; }
  .sheet .content { padding: 12px; display: grid; gap: 10px; grid-template-columns: 1fr; color:#e7ecff; }
  .row { display:flex; align-items:center; gap:10px; }
  .row label { font-size: 12px; color:#b8c1ff; }
  .muted { color:#a9b0d9; font-size:12px; }
</style>
</head>
<body>
<div class="app">
  <header>
    <h1>Beatbot Mini</h1>
    <p>–¢–æ—Ä–∫–Ω–∏—Å—å –∫—Ä–æ–∫—ñ–≤ —ñ –≥—Ä–∞–π. –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω—É. –ö–Ω–æ–ø–∫–∞ –®—Ç–æ—Ä–∫–∞ –≤—ñ–¥–∫—Ä–∏–≤–∞—î –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è.</p>
  </header>
  <div class="controls">
    <button class="btn" onclick="play()">Play</button>
    <button class="btn" onclick="stop()">Stop</button>
    <label class="muted">BPM <input type="range" id="bpm" min="60" max="200" value="140" oninput="setBpm(this.value)"></label>
    <button class="btn" id="openSheet">–®—Ç–æ—Ä–∫–∞</button>
  </div>
  <div class="seq">
    <div id="grid" class="grid"></div>
  </div>
</div>

<!-- –®—Ç–æ—Ä–∫–∞ -->
<div class="sheet" id="sheet">
  <div class="handle" id="dragHandle"></div>
  <div class="content">
    <div class="row">
      <label>–ú–∞—Å—à—Ç–∞–± —Å—ñ—Ç–∫–∏</label>
      <input type="range" id="zoomRange" min="0.6" max="1.6" step="0.02" value="1" oninput="setZoom(this.value)">
      <span id="zoomOut" class="muted">100%</span>
    </div>
    <div class="row">
      <label>–ö—Ä–æ–∫—ñ–≤</label>
      <select id="stepsSel" onchange="setSteps(this.value)">
        <option value="8">8</option>
        <option value="12">12</option>
        <option value="16" selected>16</option>
        <option value="32">32</option>
      </select>
    </div>
    <div class="row">
      <button class="btn" onclick="randomize()">–†–∞–Ω–¥–æ–º</button>
      <button class="btn" onclick="clearGrid()">–û—á–∏—Å—Ç–∏—Ç–∏</button>
      <button class="btn" onclick="closeSheet()">–ó–∞–∫—Ä–∏—Ç–∏</button>
    </div>
    <p class="muted">–ü—ñ–¥–∫–∞–∑–∫–∞: –ø—Ä–æ–≤–µ–¥–∏ –≤–Ω–∏–∑ –ø–æ —à—Ç–æ—Ä—Ü—ñ, —â–æ–± –∑–∞–∫—Ä–∏—Ç–∏.</p>
  </div>
</div>

<script>
  const instruments = [ {id:'kick',name:'ü•Å'}, {id:'snare',name:'üß®'}, {id:'clap',name:'üëè'}, {id:'cow',name:'üîî'}, {id:'hat',name:'üå´'} ];
  let steps=16, pattern={}; instruments.forEach(i=>pattern[i.id]=Array(steps).fill(0));

  function buildGrid(){
    const g=document.getElementById('grid'); g.innerHTML='';
    g.style.gridTemplateColumns = `var(--labelW) repeat(${steps}, calc(var(--cellBase) * var(--zoom)))`;
    instruments.forEach(inst=>{
      const label=document.createElement('div'); label.className='rowLabel'; label.textContent=inst.name; g.appendChild(label);
      for(let i=0;i<steps;i++){
        const c=document.createElement('div'); c.className='cell'; c.dataset.inst=inst.id; c.dataset.step=i; const d=document.createElement('div'); d.className='dot'; c.appendChild(d);
        if(pattern[inst.id][i]) c.classList.add('active');
        c.addEventListener('click', ()=>{ pattern[inst.id][i]^=1; c.classList.toggle('active'); }, {passive:true});
        g.appendChild(c);
      }
    });
  }

  // –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç - –ø–æ–∫–∏ –∑–∞–≥–ª—É—à–∫–∏, —Ç–∏ –∫–∞–∑–∞–≤ –≥–æ–ª–æ–≤–Ω–µ —à—Ç–æ—Ä–∫–∞
  function play(){ alert('Play logic —Ç—É—Ç. –Ø–∫—â–æ —Ç—Ä–µ–±–∞ - –≤–∫–ª—é—á—É Web Audio.'); }
  function stop(){ alert('Stop logic —Ç—É—Ç.'); }
  function setBpm(v){ document.getElementById('bpm').title=v+' BPM'; }

  // –®—Ç–æ—Ä–∫–∞
  const sheet = document.getElementById('sheet');
  const openBtn = document.getElementById('openSheet');
  const handle = document.getElementById('dragHandle');
  let startY=0, startOpen=false;
  openBtn.addEventListener('click', ()=>{ sheet.classList.add('open'); });
  function closeSheet(){ sheet.classList.remove('open'); }
  window.closeSheet = closeSheet;
  // drag to close
  handle.addEventListener('touchstart', e=>{ startY = e.touches[0].clientY; startOpen = sheet.classList.contains('open'); }, {passive:true});
  handle.addEventListener('touchmove', e=>{
    const dy = e.touches[0].clientY - startY;
    if(dy>40 && startOpen) closeSheet();
  }, {passive:true});

  // –ú–∞—Å—à—Ç–∞–±
  function setZoom(val){
    document.documentElement.style.setProperty('--zoom', val);
    document.getElementById('zoomOut').textContent = Math.round(val*100)+'%';
  }
  window.setZoom = setZoom;

  // –ö—Ä–æ–∫–∏
  function setSteps(v){
    const newSteps = parseInt(v,10);
    const resized = {};
    instruments.forEach(inst=>{
      const src = pattern[inst.id]||[]; const next = Array(newSteps).fill(0);
      for(let i=0;i<Math.min(src.length,newSteps);i++) next[i]=src[i];
      resized[inst.id]=next;
    });
    steps=newSteps; pattern=resized; buildGrid();
  }
  window.setSteps = setSteps;

  function randomize(){
    const density = { kick: 0.25, snare: 0.2, clap: 0.15, cow: 0.12, hat: 0.75 };
    instruments.forEach(inst=>{ pattern[inst.id] = Array.from({length: steps}, ()=> Math.random() < (density[inst.id]||0.2) ? 1 : 0 ); });
    buildGrid();
  }
  function clearGrid(){ instruments.forEach(inst=> pattern[inst.id]=Array(steps).fill(0)); buildGrid(); }
  window.randomize = randomize; window.clearGrid = clearGrid;

  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
  buildGrid();
</script>
</body>
</html>
